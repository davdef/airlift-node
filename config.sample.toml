# Airlift Node - Beispielkonfiguration (Graph-Pipeline)
#
# Hinweis:
# - Sobald "ringbuffers/inputs/outputs/services" gesetzt sind, wird die Graph-Pipeline genutzt.
# - Es wird aktuell genau ein Ringbuffer und genau ein Input-Typ unterstützt.
# - Für Icecast/HTTP-Streams wird ein Ogg/Opus-Stream erwartet.

[ring]
# Legacy-Einstellung (wird nur genutzt, wenn keine Graph-Pipeline aktiv ist)
slots = 6000
prealloc_samples = 9600

[monitoring]
# HTTP-Port für /metrics und /health (Monitoring-Service)
http_port = 8087

[ringbuffers.main]
# Ringbuffer-ID ist "main" und muss in input/output/service "buffer" referenziert werden.
slots = 6000
prealloc_samples = 9600

[inputs.source]
# Typ: "srt" (Listener) oder "http_stream"/"icecast" (HTTP/Icecast-Stream)
# Nur ein Input-Typ ist gleichzeitig erlaubt.
type = "srt"
enabled = true
buffer = "main"

# SRT-Listener (für type = "srt")
listen = "0.0.0.0:9000"
latency_ms = 200
streamid = "airlift"

# Icecast/HTTP-Stream (für type = "http_stream" oder "icecast")
# url = "https://example.com/stream.ogg"

[services.monitoring]
# Startet den Monitoring-Service (nutzt [monitoring].http_port)
type = "monitoring"
enabled = true

[services.audio_http]
# Optionaler Audio-HTTP-Endpunkt (z. B. für Debug/Preview)
type = "audio_http"
enabled = false
# codec_id = "pcm_s16le" # bei encoded Inputs (Icecast) angeben

[outputs.srt_out]
# Optionaler SRT-Ausgang
type = "srt_out"
enabled = false
input = "source"
buffer = "main"
codec_id = "pcm_s16le"
target = "example.com:9000"
latency_ms = 200

[outputs.icecast_out]
# Optionaler Icecast-Ausgang (Ogg/MP3)
type = "icecast_out"
enabled = false
input = "source"
buffer = "main"
codec_id = "opus_ogg"
host = "icecast.local"
port = 8000
mount = "/airlift"
user = "source"
password = "hackme"
bitrate = 128000
name = "Airlift Node"
description = "Live-Stream aus dem Ringbuffer"
genre = "news"
public = false

[outputs.file_out]
# File-Out schreibt den Encoded-Stream direkt (z. B. WAV oder OGG)
type = "file_out"
enabled = true
input = "source"
buffer = "main"
# Für SRT/PCM: "wav_archive" | Für Icecast/HTTP-Streams: "opus_ogg"
codec_id = "wav_archive"
wav_dir = "/opt/rfm/airlift-node/aircheck/wav"
retention_days = 7

[codecs.pcm_s16le]
# PCM-Codec (raw)
type = "pcm"
sample_rate = 48000
channels = 2

[codecs.opus_ogg]
# Opus Ogg (Icecast-kompatibel)
type = "opus_ogg"
sample_rate = 48000
channels = 2
frame_size_ms = 20
bitrate = 128000
application = "audio"

[codecs.wav_archive]
# PCM in WAV-Container (Recorder)
type = "pcm"
sample_rate = 48000
channels = 2
container = "wav"
