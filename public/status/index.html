<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airlift Audio Node</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <img src="rfm-logo.png" alt="RFM Logo">
    <h1>Airlift Audio Node</h1>
    <div class="header-meta">
        <div class="conn-status">
            <span class="conn-dot"></span>
            <span id="connText">Verbinde...</span>
        </div>
        <div class="studio-time" id="studioTime">‚Äì</div>
        <div style="font-size: 12px; color: #888;">
            Aktualisiert: <span id="updateTime">‚Äì</span>
        </div>
    </div>
</header>

<main>
    <section class="panel hidden" id="offlinePanel">
        <div class="panel-header">
            <h2 class="panel-title">API Offline</h2>
        </div>
        <div class="panel-content">
            <div class="setup-message">
                <div class="setup-icon">‚ö†Ô∏è</div>
                <div>
                    <div class="setup-title">Die Status-API ist derzeit nicht erreichbar.</div>
                    <div class="setup-subtitle">Bitte API starten und Konfiguration pr√ºfen.</div>
                </div>
            </div>
            <div class="setup-issues">
                <h3>API aktivieren</h3>
                <ul>
                    <li>In <code>config.toml</code> <code>api.enabled = true</code> setzen.</li>
                    <li>Standard-Bind: <code>api.bind = "0.0.0.0:3008"</code>.</li>
                    <li>Service neu starten, damit die API lauscht.</li>
                </ul>
            </div>
            <div class="setup-actions">
                <a class="btn primary" href="../config.sample.toml" target="_blank" rel="noopener">Setup-Leitfaden √∂ffnen</a>
            </div>
        </div>
    </section>

    <section class="panel hidden" id="setupPanel">
        <div class="panel-header">
            <h2 class="panel-title">Setup-Leitfaden</h2>
        </div>
        <div class="panel-content">
            <div class="setup-message">
                <div class="setup-icon">üß≠</div>
                <div>
                    <div class="setup-title" id="setupNextStep">Konfiguration pr√ºfen</div>
                    <div class="setup-subtitle">F√ºhre den n√§chsten Schritt aus, um die Audio-Pipeline zu starten.</div>
                </div>
            </div>
            <div class="setup-section hidden" id="setupIssuesSection">
                <div class="setup-section-header">Setup-Checks</div>
                <div class="setup-section-subtitle">Offene Konfigurationspunkte mit minimalen Beispielen.</div>
                <div class="setup-issues-list" id="setupIssues"></div>
            </div>
            <div class="setup-section" id="setupPreviewSection">
                <div class="setup-section-header">Pipeline-Preview</div>
                <div class="setup-section-subtitle">Konfiguration aus dem Pipeline-Graphen erzeugen und pr√ºfen.</div>
                <div class="setup-preview-validation" id="setupPreviewValidation"></div>
                <pre class="setup-preview-code" id="setupPreview">{}</pre>
            </div>
            <div class="setup-actions">
                <a class="btn primary" href="../config.sample.toml" target="_blank" rel="noopener">Beispiel-Konfig √∂ffnen</a>
                <button class="btn" id="generateMinimalConfig" type="button">Konfiguration generieren</button>
            </div>
        </div>
    </section>

    <!-- Audio Pipeline Tree - jetzt zweispaltig -->
    <section class="panel pipeline-tree" id="pipelinePanel">
        <div class="panel-header">
            <h2 class="panel-title">Audio Pipeline</h2>
            <button class="btn small" onclick="refreshAllData()" style="padding: 6px 10px; font-size: 11px;">
                ‚Üª Aktualisieren
            </button>
        </div>
        <div class="panel-content">
            <div class="pipeline-container" id="pipelineTree">
                <div class="pipeline-editor" id="pipelineEditor">
                    <div class="pipeline-palette">
                        <div class="pipeline-palette-title">Palette</div>
                        <div class="pipeline-palette-list" id="pipelinePalette"></div>
                    </div>
                    <div class="pipeline-canvas" id="pipelineCanvas">
                        <svg class="pipeline-edges" id="pipelineEdges"></svg>
                        <div class="pipeline-nodes" id="pipelineNodes"></div>
                        <div class="pipeline-canvas-hint" id="pipelineCanvasHint">
                            Module aus der Palette ziehen, um eine Pipeline aufzubauen.
                        </div>
                        <div class="pipeline-empty-overlay hidden" id="pipelineEmptyOverlay">
                            <div class="pipeline-empty-title">Drag input here</div>
                            <div class="pipeline-empty-subtitle">Ziehe ein Input-Modul aus der Palette, um die Pipeline zu starten.</div>
                        </div>
                    </div>
                    <div class="pipeline-inspector">
                        <div class="pipeline-inspector-title">Inspector</div>
                        <div class="pipeline-inspector-body" id="pipelineInspector">
                            <div class="empty-state">
                                <div class="icon">üß©</div>
                                <div class="message">W√§hle ein Modul aus.</div>
                            </div>
                        </div>
                        <div class="pipeline-context" id="pipelineContext">
                            <div class="pipeline-context-title">Setup-Hinweise</div>
                            <div class="pipeline-context-next" id="pipelineContextNextStep">Konfiguration pr√ºfen</div>
                            <ul class="pipeline-context-list" id="pipelineContextHints"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Zwei-Spalten-Layout f√ºr den Rest -->
    <div class="main-content" id="mainContent">
        <!-- Linke Spalte -->
        <div style="display: flex; flex-direction: column; gap: 16px;">
            <!-- Ringbuffer Visualization -->
            <section class="panel" id="ringbufferPanel">
                <div class="panel-header">
                    <h2 class="panel-title" id="ringbufferTitle">Ringbuffer</h2>
                    <div style="font-size: 11px; color: #888;">
                        <span id="ringbufferInfo">F√ºllstand: 0%</span>
                    </div>
                </div>
                <div class="panel-content">
                    <div class="waveform-container">
                        <canvas class="waveform-canvas" id="ringbufferCanvas"></canvas>
                        <div class="waveform-overlay" id="ringbufferOverlay"></div>
                        <div class="waveform-time-display" id="ringbufferTime">‚Äì</div>
                    </div>
                    <div class="waveform-stats" id="ringbufferStats">
                        <!-- Stats will be added here -->
                    </div>
                </div>
            </section>

            <!-- Active Modules -->
            <section class="panel" id="activeModulesPanel">
                <div class="panel-header">
                    <h2 class="panel-title">Aktive Module</h2>
                    <span style="font-size: 11px; color: #888;" id="activeModulesCount">0</span>
                </div>
                <div class="panel-content">
                    <table class="compact-table" id="modulesTable">
                        <thead>
                            <tr>
                                <th>Modul</th>
                                <th>Typ</th>
                                <th>Status</th>
                                <th>Datenrate</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4" class="empty-state">
                                    <div class="icon">üì¶</div>
                                    <div class="message">Lade Module...</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Available Modules -->
            <section class="panel" id="inactiveModulesPanel">
                <div class="panel-header">
                    <h2 class="panel-title">Verf√ºgbare Module</h2>
                    <span style="font-size: 11px; color: #888;" id="inactiveModulesCount">0</span>
                </div>
                <div class="panel-content">
                    <table class="compact-table" id="inactiveModulesTable">
                        <thead>
                            <tr>
                                <th>Modul</th>
                                <th>Typ</th>
                                <th>Status</th>
                                <th>Grund</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4" class="empty-state">
                                    <div class="icon">üîå</div>
                                    <div class="message">Keine inaktiven Module</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Rechte Spalte -->
        <div style="display: flex; flex-direction: column; gap: 16px;">
            <!-- File-Out WAV File -->
            <section class="panel" id="fileOutPanel">
                <div class="panel-header">
                    <h2 class="panel-title">File-Out (1h Datei)</h2>
                    <div style="font-size: 11px; color: #888;">
                        <span id="recorderProgress">0%</span>
                    </div>
                </div>
                <div class="panel-content">
                    <div class="waveform-container">
                        <canvas class="waveform-canvas" id="recorderCanvas"></canvas>
                        <div class="waveform-overlay" id="recorderOverlay"></div>
                        <div class="waveform-time-display" id="recorderTime">‚Äì</div>
                    </div>
                    <div class="recorder-files" id="recorderFiles">
                        <div class="empty-state" style="padding: 20px;">
                            <div class="icon">üìÅ</div>
                            <div class="message">Lade File-Out-Info...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Controls -->
            <section class="panel" id="controlsPanel">
                <div class="panel-header">
                    <h2 class="panel-title">Steuerung</h2>
                </div>
                <div class="panel-content">
                    <div class="controls-grid" id="controlsGrid">
                        <button class="btn" disabled>Lade...</button>
                    </div>
                </div>
            </section>

            <!-- Codecs -->
            <section class="panel" id="codecsPanel">
                <div class="panel-header">
                    <h2 class="panel-title">Verf√ºgbare Codecs</h2>
                </div>
                <div class="panel-content">
                    <div class="codecs-list" id="codecsList">
                        <div class="empty-state" style="padding: 20px;">
                            <div class="icon">üîä</div>
                            <div class="message">Lade Codecs...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- System Status -->
            <section class="panel" id="systemStatusPanel">
                <div class="panel-header">
                    <h2 class="panel-title">System Status</h2>
                </div>
                <div class="panel-content">
                    <div class="waveform-stats">
                        <div class="waveform-stat">
                            <div class="waveform-stat-label">Studio-Zeit</div>
                            <div class="waveform-stat-value" id="systemStudioTime">‚Äì</div>
                            <div class="waveform-stat-sub">Sendezeit aus Studio</div>
                        </div>
                        <div class="waveform-stat">
                            <div class="waveform-stat-label">Latenz</div>
                            <div class="waveform-stat-value" id="systemLatency">‚Äì</div>
                            <div class="waveform-stat-sub">Verz√∂gerung</div>
                        </div>
                        <div class="waveform-stat">
                            <div class="waveform-stat-label">Peaks Buffer</div>
                            <div class="waveform-stat-value" id="systemPeaksBuffer">‚Äì</div>
                            <div class="waveform-stat-sub">100ms Punkte</div>
                        </div>
                        <div class="waveform-stat">
                            <div class="waveform-stat-label">Audio Buffer</div>
                            <div class="stat-value" id="systemAudioBuffer">‚Äì</div>
                            <div class="waveform-stat-sub">Sekunden</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</main>

<div id="messageBar" class="message-bar"></div>

<script src="main.js"></script>
<script src="waveform.js"></script>
</body>
</html>
